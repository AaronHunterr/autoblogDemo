<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>Widget Comparison</title>

  <!-- Poppins for page + widgets -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css" />
  <style>
    body { font-family:'Poppins',sans-serif; }
    /* Panel backgrounds: default vs minimal */
    .demo-panel { background:#2d3442; border-radius:12px; }
    .demo-panel.is-minimal { background:#eef1f5; }
    /* Keep controls readable if your base CSS is dark */
    .controls .label { color:#e5e7eb; }
  </style>
</head>
<body>
  <header class="site-header" id="siteHeader">
    <div class="container header__inner">
      <a class="brand" href="./">
        <span class="brand__mark" aria-hidden="true">⬤</span>
        <span class="brand__text">Auto News Demo</span>
      </a>
      <nav class="site-nav" id="siteNav" aria-label="Primary">
        <a href="./widget.html">Widget Test</a>
        <a href="./quotes.html" class="is-active">Widget Comparison</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="container hero__inner">
      <h1 class="hero__title">Widget Comparison</h1>
      <p class="hero__dek">Choose widget types and colors for Left and Right. See them side-by-side and in a stacked view below.</p>
    </div>
  </section>

  <main class="container quotes-wrap">
    <!-- ======= CONTROLS ROW ======= -->
    <div class="controls" id="controlsRow">
      <!-- LEFT controls -->
      <div class="group" id="typeA">
        <span class="label">Left:</span>
        <button class="btn is-active" data-type="new-car-funnel">Funnel</button>
        <button class="btn" data-type="new-car-funnel-compact">Funnel (Compact)</button>

        <button class="btn" data-type="new-car-quote">New Quote</button>
        <button class="btn" data-type="new-car-quote-minimal">New Quote (Minimal)</button>

        <button class="btn" data-type="used-car-quote">Used Quote</button>
        <button class="btn" data-type="used-car-quote-minimal">Used Quote (Minimal)</button>

        <button class="btn" data-type="new-car-image">New Image</button>
        <button class="btn" data-type="new-car-image-compact">New Image (Compact)</button>

        <button class="btn" data-type="used-car-image">Used Image</button>

        <button class="btn" data-type="calculator">Calculator</button>
        <button class="btn" data-type="used-pay-body">Used by Payment & Body</button>
        <button class="btn" data-type="used-pay-mm">Used by Payment, Make & Model</button>
      </div>

      <div class="group" id="colorA">
        <span class="label">Color</span>
        <span class="swatch is-active" style="background:#303745" data-color="#303745"></span>
        <span class="swatch" style="background:#fd4e3f" data-color="#fd4e3f"></span>
        <span class="swatch" style="background:#de2828" data-color="#de2828"></span>
        <span class="swatch" style="background:#252629" data-color="#252629"></span>
        <span class="swatch" style="background:#000000" data-color="#000000"></span>
        <span class="swatch" style="background:#ffba3a" data-color="#ffba3a"></span>
        <div class="hex-input">
          <input id="hexInputA" type="text" placeholder="#RRGGBB" maxlength="7" />
          <button class="btn" id="applyHexA">Apply</button>
        </div>
      </div>

      <div class="group" id="targetA" style="display:none;">
        <span class="label">Submit</span>
        <button class="btn is-active" data-target="parent">Same tab</button>
        <button class="btn" data-target="blank">New tab</button>
      </div>

      <!-- RIGHT controls -->
      <div class="group" id="typeB">
        <span class="label">Right:</span>
        <button class="btn is-active" data-type="new-car-funnel">Funnel</button>
        <button class="btn" data-type="new-car-funnel-compact">Funnel (Compact)</button>

        <button class="btn" data-type="new-car-quote">New Quote</button>
        <button class="btn" data-type="new-car-quote-minimal">New Quote (Minimal)</button>

        <button class="btn" data-type="used-car-quote">Used Quote</button>
        <button class="btn" data-type="used-car-quote-minimal">Used Quote (Minimal)</button>

        <button class="btn" data-type="new-car-image">New Image</button>
        <button class="btn" data-type="new-car-image-compact">New Image (Compact)</button>

        <button class="btn" data-type="used-car-image">Used Image</button>

        <button class="btn" data-type="calculator">Calculator</button>
        <button class="btn" data-type="used-pay-body">Used by Payment & Body</button>
        <button class="btn" data-type="used-pay-mm">Used by Payment, Make & Model</button>
      </div>

      <div class="group" id="colorB">
        <span class="label">Color</span>
        <span class="swatch" style="background:#303745" data-color="#303745"></span>
        <span class="swatch" style="background:#fd4e3f" data-color="#fd4e3f"></span>
        <span class="swatch is-active" style="background:#de2828" data-color="#de2828"></span>
        <span class="swatch" style="background:#252629" data-color="#252629"></span>
        <span class="swatch" style="background:#000000" data-color="#000000"></span>
        <span class="swatch" style="background:#ffba3a" data-color="#ffba3a"></span>
        <div class="hex-input">
          <input id="hexInputB" type="text" placeholder="#RRGGBB" maxlength="7" />
          <button class="btn" id="applyHexB">Apply</button>
        </div>
      </div>

      <div class="group" id="targetB" style="display:none;">
        <span class="label">Submit</span>
        <button class="btn is-active" data-target="parent">Same tab</button>
        <button class="btn" data-target="blank">New tab</button>
      </div>
    </div>

    <!-- ======= TOP: side-by-side ======= -->
    <div class="quotes-grid" style="margin-top:10px;">
      <section class="quotes-card demo-panel" id="panelA"><div id="slotA"></div></section>
      <section class="quotes-card demo-panel" id="panelB"><div id="slotB"></div></section>
    </div>

    <!-- ======= BOTTOM: stacked mirrors ======= -->
    <section class="quotes-card demo-panel" id="panelA2" style="margin-top:16px;"><div id="slotA_stack"></div></section>
    <section class="quotes-card demo-panel" id="panelB2" style="margin-top:16px;"><div id="slotB_stack"></div></section>
  </main>

  <footer class="site-footer">
    <div class="container footer__inner">
      <p class="copyright">© <span id="year"></span> Demo Media.</p>
    </div>
  </footer>

  <!-- Dynamic loader for this demo page -->
  <script src="https://www.rydeshopper.com/app/shoppingtools/scripts/widget.js"></script>
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
    const dtc = window.dtc;
    const VALID_HEX = /^#([0-9a-fA-F]{6}|[0-9a-fA-F]{3})$/;

    const supportsSubmit = (t) => [
      'calculator','new-car-quote','new-car-quote-minimal',
      'used-car-quote','used-car-quote-minimal',
      'new-car-image','new-car-image-compact',
      'used-car-image','used-pay-body','used-pay-mm'
    ].includes(t);

    const isMinimal = (t) => ['new-car-quote-minimal','used-car-quote-minimal'].includes(t);

    function classAndExtras(type){
      switch(type){
        case 'new-car-funnel':         return ['dt-new-car-funnel', {}];
        case 'new-car-funnel-compact': return ['dt-new-car-funnel', { 'data-theme':'compact' }];

        case 'new-car-quote':          return ['dt-new-car-quote', {}];
        case 'new-car-quote-minimal':  return ['dt-new-car-quote', { 'data-theme':'minimal' }];

        case 'used-car-quote':         return ['dt-used-car-quote', {}];
        case 'used-car-quote-minimal': return ['dt-used-car-quote', { 'data-theme':'minimal' }];

        case 'new-car-image':          return ['dt-new-car-image', {}];
        case 'new-car-image-compact':  return ['dt-new-car-image', { 'data-theme':'compact' }];

        case 'used-car-image':         return ['dt-used-car-image', {}];

        case 'calculator':             return ['dt-car-payment-calculator', {}];
        case 'used-pay-body':          return ['dt-used-car-payment-body-type', {}];
        case 'used-pay-mm':            return ['dt-used-car-payment-makes-models', {}];
      }
    }

    function buildEl(state){
      const { type, color, target='parent' } = state;
      const [cls, extras] = classAndExtras(type);
      const el = document.createElement('div');
      el.className = cls;
      el.setAttribute('data-gid','0000-5200');
      el.setAttribute('data-tenant','RSP1995');
      el.setAttribute('data-color-primary', color);

      // Ensure Poppins in the widget
      el.setAttribute('data-font-primary','Poppins');
      el.setAttribute('data-font-secondary','Poppins');

      if (cls === 'dt-new-car-funnel'){ el.setAttribute('data-make','Chevrolet'); el.setAttribute('data-model','Blazer'); }
      Object.entries(extras).forEach(([k,v])=>el.setAttribute(k,v));
      if (supportsSubmit(type)) el.setAttribute('data-submit-target', target);
      return el;
    }

    function setPanelBg(panel, type){
      panel.classList.toggle('is-minimal', isMinimal(type));
    }

    // Defaults
    let left  = { type:'new-car-funnel', color:'#303745', target:'parent' };
    let right = { type:'new-car-funnel', color:'#de2828', target:'parent' };

    // Panels + slots
    const panelA  = document.getElementById('panelA');
    const panelB  = document.getElementById('panelB');
    const panelA2 = document.getElementById('panelA2');
    const panelB2 = document.getElementById('panelB2');

    const slotA = document.getElementById('slotA');
    const slotB = document.getElementById('slotB');
    const slotA_stack = document.getElementById('slotA_stack');
    const slotB_stack = document.getElementById('slotB_stack');

    // Instances
    const instA  = new dtc.Widget({slot:1});
    const instB  = new dtc.Widget({slot:2});
    const instA2 = new dtc.Widget({slot:3});
    const instB2 = new dtc.Widget({slot:4});

    async function render(){
      // Panel backgrounds
      [ [panelA,left], [panelB,right], [panelA2,left], [panelB2,right] ].forEach(([p,c])=>setPanelBg(p,c.type));

      // Clear mounts
      [slotA,slotB,slotA_stack,slotB_stack].forEach(s=>s.innerHTML='');

      // Build + render
      const elA  = buildEl(left);
      const elB  = buildEl(right);
      const elA2 = buildEl(left);
      const elB2 = buildEl(right);

      slotA.appendChild(elA);   slotB.appendChild(elB);
      slotA_stack.appendChild(elA2); slotB_stack.appendChild(elB2);

      await instA.render(elA);
      await instB.render(elB);
      await instA2.render(elA2);
      await instB2.render(elB2);
    }

    // ----- Wire controls -----
    function wireType(groupId, which){
      document.querySelectorAll('#'+groupId+' .btn').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          document.querySelectorAll('#'+groupId+' .btn').forEach(b=>b.classList.remove('is-active'));
          btn.classList.add('is-active');
          (which==='A'? left : right).type = btn.dataset.type;

          // show/hide submit target control for this side
          const targetGroupId = which==='A' ? 'targetA' : 'targetB';
          document.getElementById(targetGroupId).style.display =
            supportsSubmit(btn.dataset.type) ? '' : 'none';

          // re-render both instances on this side
          await instA.unmount(); await instA2.unmount();
          await instB.unmount(); await instB2.unmount();
          render();
        });
      });
    }

    function wireColor(groupId, which){
      document.querySelectorAll('#'+groupId+' .swatch').forEach(s=>{
        s.addEventListener('click', async ()=>{
          document.querySelectorAll('#'+groupId+' .swatch').forEach(x=>x.classList.remove('is-active'));
          s.classList.add('is-active');
          (which==='A'? left : right).color = s.dataset.color;
          await instA.unmount(); await instA2.unmount();
          await instB.unmount(); await instB2.unmount();
          render();
        });
      });
    }

    function wireHex(applyBtnId, inputId, which){
      document.getElementById(applyBtnId).addEventListener('click', async ()=>{
        const val = document.getElementById(inputId).value.trim();
        if (!VALID_HEX.test(val)) { alert('Enter a valid HEX like #303745'); return; }
        (which==='A'? left : right).color = val;
        await instA.unmount(); await instA2.unmount();
        await instB.unmount(); await instB2.unmount();
        render();
      });
    }

    function wireTarget(groupId, which){
      document.querySelectorAll('#'+groupId+' .btn').forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          document.querySelectorAll('#'+groupId+' .btn').forEach(b=>b.classList.remove('is-active'));
          btn.classList.add('is-active');
          (which==='A'? left : right).target = btn.dataset.target;
          // Only matters when the selected type supports submit
          await instA.unmount(); await instA2.unmount();
          await instB.unmount(); await instB2.unmount();
          render();
        });
      });
    }

    // Wire both sides
    wireType('typeA','A');  wireColor('colorA','A');  wireHex('applyHexA','hexInputA','A');  wireTarget('targetA','A');
    wireType('typeB','B');  wireColor('colorB','B');  wireHex('applyHexB','hexInputB','B');  wireTarget('targetB','B');

    // Initialize visibility of submit-target groups
    document.getElementById('targetA').style.display = supportsSubmit(left.type)  ? '' : 'none';
    document.getElementById('targetB').style.display = supportsSubmit(right.type) ? '' : 'none';

    // Initial render
    render();
  </script>
</body>
</html>
